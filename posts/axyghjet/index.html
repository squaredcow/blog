<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<title> CRDTs for Collaborative Writing | squaredcow.dev</title>
<meta name=description content="As a reader of my sorts, this is me moving towards the world of writing. With time I realized that each new learning takes time from us. The way I see it, the last piece to complete the exchange is to write it down. No more drafts left unfinished! That said, dear reader: Welcome!">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="all,follow">
<meta name=googlebot content="index,follow,snippet,archive">
<meta property="og:title" content="CRDTs for Collaborative Writing">
<meta property="og:description" content="Introduction to CRDTs">
<meta property="og:type" content="article">
<meta property="og:url" content="https://squaredcow.dev/posts/axyghjet/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-07-31T00:00:00+00:00">
<meta property="article:modified_time" content="2021-07-31T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="CRDTs for Collaborative Writing">
<meta name=twitter:description content="Introduction to CRDTs">
<link rel=stylesheet href=https://squaredcow.dev/css/style-white.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]-->
<link rel=icon type=image/png href=https://squaredcow.dev/images/favicon.ico>
<link disabled id=dark-mode-theme rel=stylesheet href=/css/style-dark.css>
</head>
<body class="max-width mx-auto px3 ltr">
<div class="content index py4">
<div id=header-post>
<a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu>
<span id=nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Blog</a></li>
<li><a href=/author>Author</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/license>License</a></li>
</ul>
</span>
<br>
<span id=actions>
<ul>
<li>
<a class=icon href=https://squaredcow.dev/author/ aria-label=Previous>
<i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i>
</a>
</li>
<li>
<a class=icon href=# aria-label=Share>
<i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i>
</a>
</li>
</ul>
<span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span>
</span>
<br>
<div id=share style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f" aria-label=Facebook>
<i class="fab fa-facebook" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&text=CRDTs%20for%20Collaborative%20Writing" aria-label=Twitter>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&title=CRDTs%20for%20Collaborative%20Writing" aria-label=Linkedin>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&is_video=false&description=CRDTs%20for%20Collaborative%20Writing" aria-label=Pinterest>
<i class="fab fa-pinterest" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=CRDTs%20for%20Collaborative%20Writing&body=Check out this article: https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f" aria-label=Email>
<i class="fas fa-envelope" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&title=CRDTs%20for%20Collaborative%20Writing" aria-label=Pocket>
<i class="fab fa-get-pocket" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&title=CRDTs%20for%20Collaborative%20Writing" aria-label=reddit>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&name=CRDTs%20for%20Collaborative%20Writing&description=Introduction%20to%20CRDTs" aria-label=Tumblr>
<i class="fab fa-tumblr" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&t=CRDTs%20for%20Collaborative%20Writing" aria-label="Hacker News">
<i class="fab fa-hacker-news" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#init-journey-and-journal>Init Journey and Journal</a></li>
<li><a href=#collaborative-text-how-does-it-work>Collaborative Text: How does it work?</a></li>
<li><a href=#diving-into-crdts>Diving into CRDTs</a>
<ul>
<li><a href=#the-clay-and-bricks-of-crdts>The clay and bricks of CRDTs</a></li>
<li><a href=#state-based-and-operation-based>State-based and Operation-based</a></li>
</ul>
</li>
<li><a href=#building-basic-crdts>Building basic CRDTs</a>
<ul>
<li><a href=#counters>Counters</a></li>
<li><a href=#grow-only-counter-g-counter>Grow-only Counter (G-Counter)</a></li>
</ul>
</li>
<li><a href=#closing-words-and-next-steps>Closing words and next-steps</a></li>
</ul>
</nav>
</div>
</span>
</div>
<article class=post itemscope itemtype=http://schema.org/BlogPosting>
<header>
<h1 class=posttitle itemprop="name headline">
CRDTs for Collaborative Writing
</h1>
<div class=meta>
<div class=postdate>
<time datetime="2021-07-31 00:00:00 +0000 UTC" itemprop=datePublished>2021-07-31</time>
</div>
</div>
</header>
<div class=content itemprop=articleBody>
<h2 id=init-journey-and-journal>Init Journey and Journal</h2>
<p>These past months I&rsquo;ve been helping out with technical screen interviews on the job, the regular 1-hour meeting in which the candidate is given a code challenge and must provide a decent working solution by the end of it.</p>
<p>Surprisingly enough, the place I work at does not provide access to any interview platform to assess the candidate&rsquo;s skills, leaving me in a tight spot. From time to time, I have to request them to open the IDE of their choice and kindly share the screen, which I found invasive and likely to reduce the formality of the process.</p>
<p>Nowadays, there is a wide variety of paid services online such as CoderPad, CodeInterview, HackerRank, CoderByte; Just to mention a few, and all of them offer robust capabilities.</p>
<p>Similarly, on the side of free software, we have etherpad, collabedit, and Plunker. These last ones have been an experience-saver when the candidate cannot share his screen for any reason.</p>
<p>This situation got me intrigued and oddly inspired.</p>
<p>How do all these real-time collaborative text platforms operate? What is the engineering behind it? Which type of technical challenge do they face, and which approaches do they follow? Plenty of questions, right? So, it is time to start research on the foundations.</p>
<h2 id=collaborative-text-how-does-it-work>Collaborative Text: How does it work?</h2>
<p>Collaborative text web applications are asynchronous, fully powered by distributed systems, and challenged by their complexity. Consistency in the operations executed by the users takes the primary seat, while they are directly affected by the latency between the nodes.</p>
<p>If two users write, update or delete the same word in the document. Which change is the right one? Is it the last one? Is it the first one? How do we handle this edit conflict?</p>
<p>In an article published in 2011 by <em>Marc Shapiro, Nuno Pregui√ßa, Carlos Baquero, and Marek Zawirski</em> named <strong>&ldquo;A comprehensive study of Convergent and Commutative Replicated Data Types."</strong><sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> they propose the design of shared data types capable of conflict-free eventual consistency.</p>
<p>Quoting:</p>
<blockquote>
<p>Eventual consistency aims to ensure that replicas of some mutable shared object converge without foreground synchronisation. Previous approaches to eventual consistency are ad-hoc and error-prone. We study a principled approach: to base the design of shared data types on some simple formal conditions that are sufficient to guarantee eventual consistency. We call these types Convergent or Commutative Replicated Data Types (CRDTs).</p>
</blockquote>
<p>The infographic below displays an understandable glimpse of <strong>eventual consistency</strong> in <em>optimistic replications</em>.</p>
<p><img src=/images/excalidraws/the_ap_of_cap.png alt="The AP of CAP">
a). The AP of CAP</p>
<h2 id=diving-into-crdts>Diving into CRDTs</h2>
<p>To properly define a CRDT we need to look into the smaller pieces used for their construction and later elaborate on the type of operations they can execute.</p>
<h3 id=the-clay-and-bricks-of-crdts>The clay and bricks of CRDTs</h3>
<p>CRDTs build and operate with <strong>mutable</strong> and <strong>immutable</strong> data types. The immutable types are named <strong>atoms</strong>, and they hold characteristics, such as:</p>
<ol>
<li>Their content determines the type, e.g., primitives.</li>
<li>They are copiable in between processes.</li>
<li>If two of them have the same contents, they are equal.</li>
</ol>
<p>Meanwhile, the mutable types are named <strong>objects</strong> and have different characteristics than atoms, such as:</p>
<ol>
<li>They hold identity and initial state.</li>
<li>The contents of an object, also known as payload, are conformed by any number of atoms or objects.</li>
<li>They expose an interface that defines contractual operations on the object.</li>
<li>They are replicable in between processes.</li>
<li>If two objects have the same identity but are present in different processes, they are considered replicas.</li>
</ol>
<p>The operations exposed for working with objects may follow two different approaches: state-based and operation-based.</p>
<h3 id=state-based-and-operation-based>State-based and Operation-based</h3>
<p>In <strong>state-based</strong> <em>(passive)</em> replication, every state-changing operation occurs at the source then the system propagates the modified payload to an arbitrary pair of replicas infinitely often. The CRDTs implementing a state-based approach are named Convergent Replicated Data Type, <strong>CvRDTs</strong>.</p>
<p>Meanwhile, in <strong>operation-based</strong> <em>(active)</em> replication, the system transmits the state-changing operations in two phases: <code>at-source</code> (local) and <code>downstream</code> (async. in replica) one after the other, and both of them must execute atomically. The CRDTs implementing an operation-based strategy are named Commutative Replicated Data Type, <strong>CmRDTs</strong>.</p>
<p>Now, let&rsquo;s have a quick grasp of one of the basic CvRDTs next.</p>
<h2 id=building-basic-crdts>Building basic CRDTs</h2>
<h3 id=counters>Counters</h3>
<p>The most basic of the CRDTs, a primitive that lives within the replicas exposing a set of basic operations:</p>
<ul>
<li><strong>Increment/decrement</strong> the value of the counter.</li>
<li><strong>Update</strong> the value of the counter.</li>
<li><strong>Query</strong> the value of the counter.</li>
</ul>
<p>The value of the primitive must converge towards the global number of increments minus the number of decrements. These are some of the defined CRDTs counters <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>:</p>
<ul>
<li>Grow-only Counter (G-Counter): state-based counter for positive increments only.</li>
<li>Positive-Negative Counter (PN-Counter): state-based counter with a double registry for positive and negative increments.</li>
<li>Non-negative Counter: similar to PN-Counter with the restriction of not beign able to generate more decrements than the current originated increments.</li>
</ul>
<p>To provide a more thorough view of one the counters mentioned above, we picked G-Counter to further explain its operations.</p>
<h3 id=grow-only-counter-g-counter>Grow-only Counter (G-Counter)</h3>
<p>G-Counter is a state-based CRDT or CvRDT for positive increments only. As mentioned above it exposes a set of basic operations: <em>init, increment, value, merge and compare.</em></p>
<p><img src=/images/excalidraws/g-counter-ops-pt1.png alt="G-COunter OPs 1">
b). G-Counter OPS: init, increment and value.</p>
<p><img src=/images/excalidraws/g-counter-ops-pt2.png alt="G-COunter OPs 2">
c). G-Counter OPS: merge and compare.</p>
<p>To further visualize a GCounter, we can easily create a class named <code>GCounter</code> that operates with <em>integers</em> and implements each of the methods explained above.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#ff79c6>package</span> com.squaredcow.crdts<span style=color:#ff79c6>;</span>

<span style=color:#ff79c6>import</span> lombok.Data<span style=color:#ff79c6>;</span>

<span style=color:#ff79c6>import</span> java.util.Arrays<span style=color:#ff79c6>;</span>

@Data
<span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>final</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>GCounter</span> <span style=color:#8be9fd;font-style:italic>implements</span> Counter<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> <span style=color:#ff79c6>{</span>

    <span style=color:#8be9fd;font-style:italic>private</span> Integer registryId<span style=color:#ff79c6>;</span>
    <span style=color:#8be9fd;font-style:italic>private</span> Integer registrySize<span style=color:#ff79c6>;</span>
    <span style=color:#8be9fd;font-style:italic>private</span> Integer<span style=color:#ff79c6>[]</span> innerRegistry<span style=color:#ff79c6>;</span>

    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#50fa7b>GCounter</span><span style=color:#ff79c6>(</span>Integer registryId<span style=color:#ff79c6>,</span> Integer registrySize<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>registryId</span> <span style=color:#ff79c6>=</span> registryId<span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>registrySize</span> <span style=color:#ff79c6>=</span> registrySize<span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>innerRegistry</span> <span style=color:#ff79c6>=</span>  <span style=color:#ff79c6>new</span> Integer<span style=color:#ff79c6>[</span>registrySize<span style=color:#ff79c6>];</span>
    <span style=color:#ff79c6>}</span>

    @Override
    <span style=color:#8be9fd;font-style:italic>public</span> GCounter <span style=color:#50fa7b>init</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        Arrays<span style=color:#ff79c6>.</span><span style=color:#50fa7b>fill</span><span style=color:#ff79c6>(</span><span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>innerRegistry</span><span style=color:#ff79c6>,</span> 0<span style=color:#ff79c6>);</span>
        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>this</span><span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    @Override
    <span style=color:#8be9fd;font-style:italic>public</span> GCounter <span style=color:#50fa7b>increment</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        Integer id <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>registryId</span><span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>innerRegistry</span><span style=color:#ff79c6>[</span>id<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>this</span><span style=color:#ff79c6>.</span><span style=color:#50fa7b>innerRegistry</span><span style=color:#ff79c6>[</span>id<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>+</span> 1<span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>this</span><span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    @Override
    <span style=color:#8be9fd;font-style:italic>public</span> Integer <span style=color:#50fa7b>value</span><span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
        Integer result <span style=color:#ff79c6>=</span> 0<span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>for</span><span style=color:#ff79c6>(</span>Integer counter <span style=color:#ff79c6>:</span> innerRegistry<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
            result <span style=color:#ff79c6>+=</span> counter<span style=color:#ff79c6>;</span>
        <span style=color:#ff79c6>}</span>
        <span style=color:#ff79c6>return</span> result<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    <span style=color:#8be9fd;font-style:italic>public</span> Boolean <span style=color:#50fa7b>compare</span><span style=color:#ff79c6>(</span>GCounter x<span style=color:#ff79c6>,</span> GCounter y<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        <span style=color:#ff79c6>for</span><span style=color:#ff79c6>(</span>Integer n <span style=color:#ff79c6>:</span> x<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getInnerRegistry</span><span style=color:#ff79c6>())</span> <span style=color:#ff79c6>{</span>
            <span style=color:#ff79c6>if</span><span style=color:#ff79c6>(</span>x<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getInnerRegistry</span><span style=color:#ff79c6>()[</span>n<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>&lt;=</span> y<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getInnerRegistry</span><span style=color:#ff79c6>()[</span>n<span style=color:#ff79c6>])</span> <span style=color:#ff79c6>{</span>
                <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>true</span><span style=color:#ff79c6>;</span>
            <span style=color:#ff79c6>}</span>
        <span style=color:#ff79c6>}</span>
        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>false</span><span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>

    <span style=color:#8be9fd;font-style:italic>public</span> Integer<span style=color:#ff79c6>[]</span> <span style=color:#50fa7b>merge</span><span style=color:#ff79c6>(</span>GCounter x<span style=color:#ff79c6>,</span> GCounter y<span style=color:#ff79c6>)</span> <span style=color:#ff79c6>{</span>
        Integer<span style=color:#ff79c6>[]</span> mergedRegistry <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> Integer<span style=color:#ff79c6>[</span>registrySize<span style=color:#ff79c6>];</span>
        <span style=color:#ff79c6>for</span><span style=color:#ff79c6>(</span><span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> 0<span style=color:#ff79c6>;</span> i <span style=color:#ff79c6>&lt;</span> x<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getInnerRegistry</span><span style=color:#ff79c6>().</span><span style=color:#50fa7b>length</span><span style=color:#ff79c6>;</span> i <span style=color:#ff79c6>++)</span> <span style=color:#ff79c6>{</span>
            Integer vx <span style=color:#ff79c6>=</span> x<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getInnerRegistry</span><span style=color:#ff79c6>()[</span>i<span style=color:#ff79c6>];</span>
            Integer vy <span style=color:#ff79c6>=</span> y<span style=color:#ff79c6>.</span><span style=color:#50fa7b>getInnerRegistry</span><span style=color:#ff79c6>()[</span>i<span style=color:#ff79c6>];</span>
            mergedRegistry<span style=color:#ff79c6>[</span>i<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> Math<span style=color:#ff79c6>.</span><span style=color:#50fa7b>max</span><span style=color:#ff79c6>(</span>vx<span style=color:#ff79c6>,</span> vy<span style=color:#ff79c6>);</span>
        <span style=color:#ff79c6>}</span>
        <span style=color:#ff79c6>return</span> mergedRegistry<span style=color:#ff79c6>;</span>
    <span style=color:#ff79c6>}</span>
<span style=color:#ff79c6>}</span>
</code></pre></td></tr></table>
</div>
</div><p>d). GCounter implementation in Java</p>
<h2 id=closing-words-and-next-steps>Closing words and next-steps</h2>
<p>This is an initial dive into the CRDTs structures themselves, we will eventually go deeper to construct a cluster of replicas that operate with them. We still need to go first through the rest of the structures mentioned, such as: <em>registers, sets and graphs</em>, but let&rsquo;s have those on a second entry on this blog series.</p>
<p>With nothing left to add, thank you for reading all the way through, until next entry.</p>
<p>&ndash; squaredcow</p>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>Paper: <a href=https://hal.inria.fr/inria-00555588/document>https://hal.inria.fr/inria-00555588/document</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
</article>
<div id=footer-post-container>
<div id=footer-post>
<div id=nav-footer style=display:none>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Blog</a></li>
<li><a href=/author>Author</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/license>License</a></li>
</ul>
</div>
<div id=toc-footer style=display:none>
<nav id=TableOfContents>
<ul>
<li><a href=#init-journey-and-journal>Init Journey and Journal</a></li>
<li><a href=#collaborative-text-how-does-it-work>Collaborative Text: How does it work?</a></li>
<li><a href=#diving-into-crdts>Diving into CRDTs</a>
<ul>
<li><a href=#the-clay-and-bricks-of-crdts>The clay and bricks of CRDTs</a></li>
<li><a href=#state-based-and-operation-based>State-based and Operation-based</a></li>
</ul>
</li>
<li><a href=#building-basic-crdts>Building basic CRDTs</a>
<ul>
<li><a href=#counters>Counters</a></li>
<li><a href=#grow-only-counter-g-counter>Grow-only Counter (G-Counter)</a></li>
</ul>
</li>
<li><a href=#closing-words-and-next-steps>Closing words and next-steps</a></li>
</ul>
</nav>
</div>
<div id=share-footer style=display:none>
<ul>
<li>
<a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f" aria-label=Facebook>
<i class="fab fa-facebook fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://twitter.com/share?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&text=CRDTs%20for%20Collaborative%20Writing" aria-label=Twitter>
<i class="fab fa-twitter fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&title=CRDTs%20for%20Collaborative%20Writing" aria-label=Linkedin>
<i class="fab fa-linkedin fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&is_video=false&description=CRDTs%20for%20Collaborative%20Writing" aria-label=Pinterest>
<i class="fab fa-pinterest fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="mailto:?subject=CRDTs%20for%20Collaborative%20Writing&body=Check out this article: https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f" aria-label=Email>
<i class="fas fa-envelope fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&title=CRDTs%20for%20Collaborative%20Writing" aria-label=Pocket>
<i class="fab fa-get-pocket fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&title=CRDTs%20for%20Collaborative%20Writing" aria-label=reddit>
<i class="fab fa-reddit fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&name=CRDTs%20for%20Collaborative%20Writing&description=Introduction%20to%20CRDTs" aria-label=Tumblr>
<i class="fab fa-tumblr fa-lg" aria-hidden=true></i>
</a>
</li>
<li>
<a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsquaredcow.dev%2fposts%2faxyghjet%2f&t=CRDTs%20for%20Collaborative%20Writing" aria-label="Hacker News">
<i class="fab fa-hacker-news fa-lg" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=actions-footer>
<a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu>
<i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick="return $('#toc-footer').toggle(),!1" aria-label=TOC>
<i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share>
<i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page">
<i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a>
</div>
</div>
</div>
<footer id=footer>
<div class=footer-left>
Copyright &copy; 2021 ¬© Luis Vaca
&nbsp;&ndash;&nbsp;
<i class="fas fa-moon" id=dark-mode-toggle aria-hidden=true></i>
</div>
<div class=footer-right>
<nav>
<ul>
<li><a href=/>Home</a></li>
<li><a href=/posts>Blog</a></li>
<li><a href=/author>Author</a></li>
<li><a href=/tags>Tags</a></li>
<li><a href=/license>License</a></li>
</ul>
</nav>
</div>
</footer>
</div>
</body>
<link rel=stylesheet href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>